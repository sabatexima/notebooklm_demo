<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚«ãƒ¼ãƒ‰ä¸€è¦§</title>
  <link rel="stylesheet" href="{{ url_for('select.static', filename='style.css') }}">
</head>
<body>
  <div class="header">
    <button class="btn-create" id="openCreateModal">ï¼‹ æ–°è¦ä½œæˆ</button>
  </div>

  <!-- æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="createModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>æ–°è¦ã‚«ãƒ¼ãƒ‰ä½œæˆ</h2>
      <form id="createCardForm">
        <label for="emoji">çµµæ–‡å­—:</label><br>
        <input type="text" id="emoji" name="emoji" value="ğŸ‘»"><br><br>
        <label for="title">ã‚¿ã‚¤ãƒˆãƒ«:</label><br>
        <input type="text" id="title" name="title"><br><br>
        <button type="submit">ä½œæˆ</button>
      </form>
    </div>
  </div>

  <div class="card-container">
    {% for card in cards %}
    <a href="{{ url_for('chat.index', title=card.title) }}" class="card-link">
      <div class="card">
        <div class="emoji">{{ card.emoji|safe }}</div>
        <div class="title">{{ card.title|safe }}</div>
        <div class="info">{{ card.date }} ãƒ» {{ card.source_count }}å€‹ã®ã‚½ãƒ¼ã‚¹</div>
      </div>
    </a>
    {% endfor %}
  </div>

  <script>
    const modal = document.getElementById("createModal");
    const openBtn = document.getElementById("openCreateModal");
    const closeBtn = document.getElementsByClassName("close-button")[0];
    const createForm = document.getElementById("createCardForm");
    const cardContainer = document.querySelector(".card-container");

    modal.style.display = "none";

    openBtn.onclick = function() {
      modal.style.display = "flex";
    }

    closeBtn.onclick = function() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    createForm.addEventListener('submit', async function(event) {
      event.preventDefault();

      const emoji = document.getElementById('emoji').value;
      const title = document.getElementById('title').value;

      const response = await fetch('/api/cards', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ emoji, title, source_count: 1 })
      });

      if (response.ok) {
        const newCardData = await response.json();
        const newCardElement = `
          <a href="/detail/${newCardData.id}" class="card-link">
            <div class="card">
              <div class="emoji">${newCardData.emoji}</div>
              <div class="title">${newCardData.title}</div>
              <div class="info">${newCardData.date} ãƒ» ${newCardData.source_count}å€‹ã®ã‚½ãƒ¼ã‚¹</div>
            </div>
          </a>
        `;
        cardContainer.insertAdjacentHTML('beforeend', newCardElement);
        modal.style.display = "none"; // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        createForm.reset(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
      } else {
        alert('ã‚«ãƒ¼ãƒ‰ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    });
  </script>
</body>
</html>

